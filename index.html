<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For 若晴 - Winter Romance</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Sacramento&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(to bottom, #101820 0%, #1e3c72 50%, #2a5298 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        canvas { position: absolute; top: 0; left: 0; }
        
        #bg-canvas { z-index: 1; pointer-events: none; }
        #main-canvas { z-index: 50; opacity: 1; }
        #start-canvas { z-index: 100; transition: opacity 0.8s; }

        /* --- 音乐控制按钮 --- */
        .music-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            z-index: 200;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }
        .music-btn svg { width: 20px; height: 20px; fill: #e0f7fa; transition: transform 0.5s; }
        .music-playing {
            animation: rotateMusic 3s linear infinite;
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
        }
        @keyframes rotateMusic { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- 自由排版的文字层 (放大版) --- */
        .text-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 60;
            pointer-events: none;
            opacity: 0;
            transition: opacity 1.5s ease;
        }
        .show-text { opacity: 1; }

        .handwritten {
            position: absolute;
            font-family: 'Ma Shan Zheng', cursive;
            color: #e0f7fa;
            text-shadow: 0 0 15px rgba(0,0,0,0.6); /* 阴影也稍微加重，增加清晰度 */
            opacity: 0;
            animation: floatIn 2.5s forwards;
        }

        /* 1. 英文标题 - 放大 */
        .title-en {
            font-family: 'Sacramento', cursive;
            font-size: 5rem; /* 原 3.5rem -> 5rem */
            color: #ffcce0;
            top: 6%;
            left: 5%;
            transform: rotate(-10deg);
            animation-delay: 0.5s;
        }

        /* 2. 中文名字 - 放大 */
        .title-cn {
            font-size: 4rem; /* 原 2.5rem -> 4rem */
            top: 18%;
            left: 10%;
            transform: rotate(5deg);
            color: #fff;
            animation-delay: 1.0s;
        }

        /* 3. 散落的祝福语 - 整体放大并调整间距 */
        .note-1 { 
            font-size: 2rem; /* 原 1.4rem -> 2rem */
            top: 32%; 
            left: 5%; 
            transform: rotate(-5deg); 
            color: #b2dfdb; 
            animation-delay: 1.5s; 
        }
        .note-2 { 
            font-size: 2.2rem; /* 原 1.6rem -> 2.2rem */
            top: 40%; 
            left: 15%; 
            transform: rotate(3deg); 
            color: #ffecb3; 
            animation-delay: 1.8s; 
        }
        .note-3 { 
            font-size: 2rem; /* 原 1.4rem -> 2rem */
            top: 50%; 
            left: 8%; 
            transform: rotate(-2deg); 
            color: #b2dfdb; 
            animation-delay: 2.1s; 
        }

        @keyframes floatIn {
            from { opacity: 0; transform: translateY(20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* 提示文字 */
        .hint-text {
            position: absolute;
            bottom: 20%;
            width: 100%;
            text-align: center;
            color: #90a4ae;
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.3rem; /* 提示字也稍微大一点 */
            z-index: 101;
            animation: pulse 2s infinite;
            pointer-events: none;
        }
        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

        /* 手机端适配 (对应放大) */
        @media (max-width: 600px) {
            .title-en { font-size: 3.5rem; left: 5%; top: 8%; }
            .title-cn { font-size: 3rem; left: 8%; top: 18%; }
            .note-1 { font-size: 1.6rem; top: 30%; left: 5%; }
            .note-2 { font-size: 1.8rem; top: 38%; left: 15%; }
            .note-3 { font-size: 1.6rem; top: 48%; left: 8%; }
            .music-btn { width: 35px; height: 35px; top: 15px; right: 15px; }
        }
    </style>
</head>
<body>

    <audio id="bgm" loop>
        <source src="night.mp3" type="audio/mpeg">
    </audio>

    <div class="music-btn" id="music-btn" onclick="toggleMusic(event)">
        <svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
    </div>

    <canvas id="bg-canvas"></canvas>
    <canvas id="start-canvas"></canvas>
    <div class="hint-text" id="hint">Click to Unwrap</div>
    <canvas id="main-canvas"></canvas>

    <div class="text-container" id="text-layer">
        <div class="handwritten title-en">Merry Christmas</div>
        <div class="handwritten title-cn">若晴</div>
        <div class="handwritten note-1">愿你快乐</div>
        <div class="handwritten note-2">不止圣诞</div>
        <div class="handwritten note-3">不止今冬 ❄️</div>
    </div>

    <script>
        // --- 音乐控制 ---
        const bgm = document.getElementById('bgm');
        const musicBtn = document.getElementById('music-btn');
        let isPlaying = false;
        function toggleMusic(e) {
            if (e) e.stopPropagation();
            if (isPlaying) {
                bgm.pause();
                musicBtn.classList.remove('music-playing');
            } else {
                bgm.play().catch(error => console.log("等待交互"));
                musicBtn.classList.add('music-playing');
            }
            isPlaying = !isPlaying;
        }

        // --- 画布逻辑 ---
        const width = window.innerWidth;
        const height = window.innerHeight;
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        const startCanvas = document.getElementById('start-canvas');
        const startCtx = startCanvas.getContext('2d');
        const mainCanvas = document.getElementById('main-canvas');
        const mainCtx = mainCanvas.getContext('2d');

        [bgCanvas, startCanvas, mainCanvas].forEach(c => { c.width = width; c.height = height; });

        function drawSketchLine(ctx, x1, y1, x2, y2, color, width = 1.5) {
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.lineCap = 'round';
            ctx.moveTo(x1, y1);
            const cx = (x1 + x2) / 2 + (Math.random() - 0.5) * 4;
            const cy = (y1 + y2) / 2 + (Math.random() - 0.5) * 4;
            ctx.quadraticCurveTo(cx, cy, x2, y2);
            ctx.stroke();
        }

        // 礼物盒
        let giftAnimId;
        function drawGiftBox() {
            startCtx.clearRect(0, 0, width, height);
            startCtx.save();
            startCtx.translate(width / 2, height / 2);
            const s = 1 + Math.sin(Date.now() / 400) * 0.02;
            startCtx.scale(s, s);
            const size = 110; const half = size / 2;
            for(let i=0; i<3; i++) {
                drawSketchLine(startCtx, -half, -half, half, -half, '#ffb7b2');
                drawSketchLine(startCtx, half, -half, half, half, '#ffb7b2');
                drawSketchLine(startCtx, half, half, -half, half, '#ffb7b2');
                drawSketchLine(startCtx, -half, half, -half, -half, '#ffb7b2');
            }
            drawSketchLine(startCtx, 0, -half, 0, half, '#fff', 2);
            drawSketchLine(startCtx, -half, 0, half, 0, '#fff', 2);
            startCtx.beginPath();
            startCtx.strokeStyle = '#fff';
            startCtx.lineWidth = 2;
            startCtx.moveTo(0, 0);
            startCtx.bezierCurveTo(-35, -45, -55, -10, 0, 0);
            startCtx.bezierCurveTo(35, -45, 55, -10, 0, 0);
            startCtx.stroke();
            startCtx.restore();
            giftAnimId = requestAnimationFrame(drawGiftBox);
        }
        giftAnimId = requestAnimationFrame(drawGiftBox);

        // 树
        function drawTree() {
            const isMobile = width < 600;
            const treeX = isMobile ? width * 0.75 : width * 0.75; 
            const treeY = height * 0.95;
            const treeH = height * 0.65;
            const maxW = isMobile ? width * 0.5 : 350;
            const colors = ['#a0d8ef', '#ffffff', '#ffebef', '#b2dfdb']; 
            let layers = 25; 
            for (let i = 0; i < layers; i++) {
                setTimeout(() => {
                    let progress = i / layers;
                    let y = treeY - treeH * (1 - progress);
                    let w = (maxW * progress) + 10;
                    let strokes = 30 + i * 5;
                    for (let j = 0; j < strokes; j++) {
                        let offsetX = (Math.random() - 0.5) * w * 1.8;
                        let startX = treeX + offsetX;
                        let startY = y + Math.random() * 20;
                        let len = 10 + Math.random() * 30;
                        let angle = Math.PI/2 + (Math.random() - 0.5) * 1.5;
                        mainCtx.beginPath();
                        mainCtx.strokeStyle = colors[Math.floor(Math.random() * colors.length)];
                        mainCtx.lineWidth = Math.random() * 2 + 0.5;
                        mainCtx.globalAlpha = 0.8;
                        mainCtx.moveTo(startX, startY);
                        mainCtx.lineTo(startX + Math.cos(angle)*len, startY + Math.sin(angle)*len);
                        mainCtx.stroke();
                    }
                    if (i === 0) {
                        mainCtx.save();
                        mainCtx.translate(treeX, treeY - treeH - 20);
                        mainCtx.fillStyle = "#fff";
                        mainCtx.shadowBlur = 20;
                        mainCtx.shadowColor = "#fff";
                        mainCtx.font = "40px Arial";
                        mainCtx.textAlign = "center";
                        mainCtx.fillText("★", 0, 0);
                        mainCtx.restore();
                    }
                }, i * 60);
            }
        }

        // 人
        function drawSkiingCoupleStepByStep() {
            const isMobile = width < 600;
            const cx = isMobile ? width * 0.25 : width * 0.25;
            const cy = height * 0.85; 
            const scale = isMobile ? 0.8 : 1.2;
            function drawStep(drawFn) {
                mainCtx.save();
                mainCtx.translate(cx, cy);
                mainCtx.scale(scale, scale);
                mainCtx.globalAlpha = 0.9; 
                drawFn();
                mainCtx.restore();
            }
            setTimeout(() => {
                drawStep(() => {
                    mainCtx.translate(-30, 0);
                    mainCtx.strokeStyle = "#90a4ae"; mainCtx.lineWidth = 4;
                    mainCtx.beginPath(); mainCtx.moveTo(-25, 15); mainCtx.lineTo(35, 15); 
                    mainCtx.quadraticCurveTo(45, 10, 50, 0); mainCtx.stroke();
                    mainCtx.translate(70, 0);
                    mainCtx.strokeStyle = "#fff"; 
                    mainCtx.beginPath(); mainCtx.moveTo(-20, 15); mainCtx.lineTo(40, 15);
                    mainCtx.quadraticCurveTo(50, 10, 55, 0); mainCtx.stroke();
                });
            }, 100);
            setTimeout(() => {
                drawStep(() => {
                    mainCtx.translate(-30, 0);
                    mainCtx.fillStyle = "#263238"; 
                    mainCtx.beginPath(); mainCtx.moveTo(0, 10); mainCtx.lineTo(5, -40); 
                    mainCtx.lineTo(20, -40); mainCtx.lineTo(25, 10); mainCtx.fill();
                    mainCtx.translate(70, 0);
                    mainCtx.fillStyle = "#e0ac69"; 
                    mainCtx.beginPath(); mainCtx.moveTo(0, 10); mainCtx.lineTo(5, -35); 
                    mainCtx.lineTo(30, -35); mainCtx.lineTo(30, 10); mainCtx.fill();
                });
            }, 400);
            setTimeout(() => {
                drawStep(() => {
                    mainCtx.translate(-30, 0);
                    mainCtx.fillStyle = "#263238"; 
                    mainCtx.beginPath(); mainCtx.moveTo(5, -35); mainCtx.lineTo(10, -80); 
                    mainCtx.lineTo(35, -80); mainCtx.lineTo(25, -35); mainCtx.fill();
                    mainCtx.translate(70, 0);
                    mainCtx.fillStyle = "#e0ac69"; 
                    mainCtx.beginPath(); mainCtx.moveTo(5, -35); mainCtx.lineTo(10, -75);
                    mainCtx.lineTo(35, -75); mainCtx.lineTo(30, -35); mainCtx.fill();
                });
            }, 800);
            setTimeout(() => {
                drawStep(() => {
                    mainCtx.translate(-30, 0);
                    mainCtx.fillStyle = "#263238"; 
                    mainCtx.beginPath(); mainCtx.arc(25, -95, 13, 0, Math.PI*2); mainCtx.fill();
                    mainCtx.fillStyle = "#546e7a"; mainCtx.fillRect(20, -98, 12, 6);
                    mainCtx.translate(70, 0);
                    mainCtx.fillStyle = "#5d4037"; 
                    mainCtx.beginPath(); mainCtx.arc(25, -90, 12, 0, Math.PI*2); mainCtx.fill();
                    mainCtx.fillStyle = "#e53935"; 
                    mainCtx.beginPath(); mainCtx.moveTo(13, -90); mainCtx.quadraticCurveTo(25, -110, 37, -90); mainCtx.fill();
                });
            }, 1200);
            setTimeout(() => {
                drawStep(() => {
                    mainCtx.translate(40, 0); 
                    mainCtx.fillStyle = "#3e2723"; 
                    for(let i=0; i<15; i++) {
                        let rx = 5 + Math.random() * 20; 
                        let ry = -10 - Math.random() * 60; 
                        mainCtx.beginPath();
                        mainCtx.ellipse(rx, ry, Math.random()*2+1, Math.random()*2+1, Math.random()*Math.PI, 0, Math.PI*2);
                        mainCtx.fill();
                    }
                    mainCtx.strokeStyle = "#cfd8dc"; mainCtx.lineWidth = 2;
                    mainCtx.beginPath(); mainCtx.moveTo(30, -65); mainCtx.lineTo(45, 15); mainCtx.stroke();
                    mainCtx.translate(-70, 0); 
                    mainCtx.beginPath(); mainCtx.moveTo(30, -70); mainCtx.lineTo(45, 15); mainCtx.stroke();
                });
            }, 1600);
        }

        // 雪花+心
        let showHearts = false;
        const snows = Array.from({length: 120}, () => ({
            x: Math.random() * width, y: Math.random() * height,
            r: Math.random() * 2 + 0.5, s: Math.random() * 1 + 0.3, type: 'snow'
        }));
        function drawSnow() {
            bgCtx.clearRect(0, 0, width, height);
            snows.forEach(p => {
                if (p.type === 'heart') {
                    bgCtx.font = (p.r * 10) + "px Arial";
                    bgCtx.fillStyle = "rgba(255, 182, 193, 0.8)";
                    bgCtx.fillText("❤", p.x, p.y);
                } else {
                    bgCtx.fillStyle = "rgba(255,255,255,0.7)";
                    bgCtx.beginPath();
                    bgCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                    bgCtx.fill();
                }
                p.y += p.s;
                if(p.y > height) {
                    p.y = -10; p.x = Math.random() * width;
                    if (showHearts && Math.random() > 0.7) p.type = 'heart';
                    else p.type = 'snow';
                }
            });
            requestAnimationFrame(drawSnow);
        }
        drawSnow();

        // 交互
        let started = false;
        document.body.addEventListener('click', () => {
            if (!isPlaying) {
                bgm.play().then(() => {
                    isPlaying = true;
                    musicBtn.classList.add('music-playing');
                }).catch(e => console.log("Waiting for interaction"));
            }
            if (started) return;
            started = true;
            showHearts = true;
            
            document.getElementById('hint').style.display = 'none';
            const startCanvasEl = document.getElementById('start-canvas');
            startCanvasEl.style.opacity = 0;
            setTimeout(() => { startCanvasEl.style.display = 'none'; cancelAnimationFrame(giftAnimId); }, 800);
            
            document.getElementById('text-layer').classList.add('show-text');
            drawTree();
            drawSkiingCoupleStepByStep();
        });
    </script>
</body>
</html>
